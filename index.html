// A. Tåg från Trafikverket - OPTIMERAD ENLIGT OFFICIELL DOKUMENTATION
            try {
                // Vi använder det korrekta tidsformatet: d.hh:mm:ss
                // Hämtar tåg från 15 minuter tillbaka i tiden, upp till 12 timmar framåt
                const tvXML = `<REQUEST>
                    <LOGIN authenticationkey="${TV_KEY}" />
                    <QUERY objecttype="TrainAnnouncement" schemaversion="1.9" orderby="AdvertisedTimeAtLocation" limit="50">
                        <FILTER>
                            <AND>
                                <EQ name="LocationSignature" value="Bs" />
                                <EQ name="ActivityType" value="Avgang" />
                                <GT name="AdvertisedTimeAtLocation" value="$dateadd(-0.00:15:00)" />
                                <LT name="AdvertisedTimeAtLocation" value="$dateadd(0.12:00:00)" />
                            </AND>
                        </FILTER>
                        <INCLUDE>InformationOwner</INCLUDE>
                        <INCLUDE>AdvertisedTimeAtLocation</INCLUDE>
                        <INCLUDE>EstimatedTimeAtLocation</INCLUDE>
                        <INCLUDE>TrackAtLocation</INCLUDE>
                        <INCLUDE>ToLocation</INCLUDE>
                        <INCLUDE>ProductInformation</INCLUDE>
                        <INCLUDE>Canceled</INCLUDE>
                    </QUERY>
                </REQUEST>`;
                
                const resT = await fetch("https://api.trafikinfo.trafikverket.se/v2/data.json", {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' }, // Viktigt: text/plain stoppar CORS-felet!
                    body: tvXML
                });
                
                if (resT.ok) {
                    const dataT = await resT.json();

                    if (dataT.RESPONSE && dataT.RESPONSE.RESULT[0].TrainAnnouncement) {
                        const trains = dataT.RESPONSE.RESULT[0].TrainAnnouncement;
                        
                        trains.forEach(t => {
                            try {
                                if (t.Canceled === true) return; 
                                
                                const rowHtml = createTrainRow(t);
                                if(rowHtml) {
                                    // Vi vet att tiden finns eftersom vi har <INCLUDE> på dem
                                    const trainTime = new Date(t.EstimatedTimeAtLocation || t.AdvertisedTimeAtLocation);
                                    combined.push({ t: trainTime, html: rowHtml, isTrain: true });
                                    tvTågAntal++;
                                }
                            } catch (e) { console.error("Fel på enskilt TV-tåg: ", e); }
                        });
                        if (tvTågAntal > 0) tvHasData = true;
                    }
                }
            } catch (e) { console.error("Fel vid hämtning från TV: ", e); }
